<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Football Clubs Map</title>
    <style>
      /* Ensure the map takes up the full viewport */
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
 function initMap() {
    var map = new google.maps.Map(document.getElementById("map"), {
        zoom: 7,
        center: { lat: 41.5, lng: 2.1 },  // Adjust this to center around your data
        mapId: "6d21538ba521f729"
    });

    // Load the CSV file from GitHub
    fetch("https://raw.githubusercontent.com/gabort-maps/football-maps/main/clubs.csv")
        .then(response => response.text())
        .then(data => {
            const rows = data.split("\n").slice(1); // Remove header
            rows.forEach(row => {
                const columns = row.split(",");
                if (columns.length >= 4) { // Ensure it's a valid row
                    const name = columns[0].trim();
                    const lat = parseFloat(columns[1]);
                    const lng = parseFloat(columns[2]);
                    const players = parseInt(columns[3]);

                    // Determine bubble size based on player count
                    const markerSize = Math.min(80, 30 + players / 20); // Max size: 80px, Min: 30px

                    // Assign a color based on player count category
                    let bubbleColor = "green"; // Default: Very Small Clubs (<150)
                    if (players >= 150 && players < 299) {
                        bubbleColor = "blue"; // Small Clubs (150-299)
                    } else if (players >= 300 && players < 500) {
                        bubbleColor = "purple"; // Medium Clubs (300-499)
                    } else if (players >= 500 && players < 600) {
                        bubbleColor = "orange"; // Large Clubs (500-699)
                    } else if (players >= 600) {
                        bubbleColor = "red"; // Very Large Clubs (700+)
                    }

                    // Create a colored bubble marker
                    const customBubble = document.createElement("div");
                    customBubble.style.width = markerSize + "px";
                    customBubble.style.height = markerSize + "px";
                    customBubble.style.borderRadius = "50%";
                    customBubble.style.backgroundColor = bubbleColor;
                    customBubble.style.display = "flex";
                    customBubble.style.justifyContent = "center";
                    customBubble.style.alignItems = "center";
                    customBubble.style.color = "white";
                    customBubble.style.fontWeight = "bold";
                    customBubble.innerText = players; // Display player count inside the bubble

                    // Add marker to the map
                    const marker = new google.maps.marker.AdvancedMarkerElement({
                        map: map,
                        position: { lat: lat, lng: lng },
                        title: name,
                        content: customBubble
                    });
                }
            });
        })
        .catch(error => console.error("Error loading CSV:", error));
}

    </script>

    <!-- Ensure this script is loaded last -->
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXOfD-urA6wwow_1mz0O-bSJ9PjwXylhQ&callback=initMap&libraries=marker">
    </script>
  </body>
</html>
