<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Football Clubs Map</title>
    <style>
      /* Ensure the map takes up the full viewport */
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
function initMap() {
    var map = new google.maps.Map(document.getElementById("map"), {
        zoom: 10,  // Adjusted zoom level
        center: { lat: 41.5, lng: 2.1 },  
        mapId: "6d21538ba521f729"
    });

    // Load the CSV file from GitHub
    fetch("https://raw.githubusercontent.com/gabort-maps/football-maps/main/clubs.csv")
        .then(response => response.text())
        .then(data => {
            const rows = data.split("\n").slice(1); // Remove header row
            rows.forEach(row => {
                const columns = row.split(",");
                if (columns.length >= 4) { // Ensure it's a valid row
                    const name = columns[0].trim();
                    const lat = parseFloat(columns[1]);
                    const lng = parseFloat(columns[2]);
                    const players = parseInt(columns[3]);

                    // Determine bubble size based on player count
                    const markerSize = Math.min(80, 30 + players / 20); // Max size: 80px, Min: 30px

                    // Assign a color based on player count category
                    let bubbleColor = "green"; // Default: Very Small Clubs (<100)
                    if (players >= 100 && players < 200) {
                        bubbleColor = "blue"; // Small Clubs (100-199)
                    } else if (players >= 200 && players < 400) {
                        bubbleColor = "purple"; // Medium Clubs (200-399)
                    } else if (players >= 400 && players < 500) {
                        bubbleColor = "orange"; // Large Clubs (400-499)
                    } else if (players >= 500) {
                        bubbleColor = "red"; // Very Large Clubs (700+)
                    }

                    // Create a styled div instead of an image for the bubble
                    const customBubble = document.createElement("div");
                    customBubble.style.width = markerSize + "px";
                    customBubble.style.height = markerSize + "px";
                    customBubble.style.borderRadius = "50%"; // Makes it a circle
                    customBubble.style.backgroundColor = bubbleColor;
                    customBubble.style.display = "flex";
                    customBubble.style.justifyContent = "center";
                    customBubble.style.alignItems = "center";
                    customBubble.style.color = "white";
                    customBubble.style.fontWeight = "bold";
                    customBubble.style.border = "2px solid white";
                    customBubble.style.cursor = "pointer"; // Makes it look clickable
                    customBubble.innerText = players; // Show player count inside the bubble

                    // Create an Info Window for the club details
                    const infoWindow = new google.maps.InfoWindow({
                        content: `<div style="text-align:center;">
                                    <strong>${name}</strong><br>
                                    Players: ${players}
                                  </div>`
                    });

                    // Add marker to the map
                    const marker = new google.maps.marker.AdvancedMarkerElement({
                        map: map,
                        position: { lat: lat, lng: lng },
                        title: name,
                        content: customBubble
                    });

                    // Make the bubble clickable to show the Info Window
                    customBubble.addEventListener("click", () => {
                        infoWindow.open(map, marker);
                    });
                }
            });
        })
        .catch(error => console.error("Error loading CSV:", error));
}


    </script>

    <!-- Ensure this script is loaded last -->
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXOfD-urA6wwow_1mz0O-bSJ9PjwXylhQ&callback=initMap&libraries=marker">
    </script>
  </body>
</html>
